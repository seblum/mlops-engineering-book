<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.4 Model Inferencing | MLOps Engineering</title>
  <meta name="description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="generator" content="bookdown 0.37 and GitBook 2.6.7" />

  <meta property="og:title" content="9.4 Model Inferencing | MLOps Engineering" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  <meta name="github-repo" content="seblum/mlops-engineering-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.4 Model Inferencing | MLOps Engineering" />
  
  <meta name="twitter:description" content="Implementing an MLOps infrastructure with Airflow and MLFlow utilizing K8s, Terraform, and GithubActions." />
  

<meta name="author" content="Sebastian Blum" />


<meta name="date" content="2024-02-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pipeline-workflow-steps.html"/>
<link rel="next" href="glossary.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">MLOps Engineering</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="preamble.html"><a href="preamble.html"><i class="fa fa-check"></i>Preamble</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html"><i class="fa fa-check"></i><b>1.1</b> Machine Learning Workflow</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#ml-worflow-tools"><i class="fa fa-check"></i><b>1.1.1</b> ML Worflow Tools</a></li>
<li class="chapter" data-level="1.1.2" data-path="machine-learning-workflow.html"><a href="machine-learning-workflow.html#developing-machine-learning-models"><i class="fa fa-check"></i><b>1.1.2</b> Developing Machine Learning Models</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html"><i class="fa fa-check"></i><b>1.2</b> Machine Learning Operations (MLOps)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#ml-dev-ops"><i class="fa fa-check"></i><b>1.2.1</b> ML + (Dev)-Ops</a></li>
<li class="chapter" data-level="1.2.2" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-lifecycle"><i class="fa fa-check"></i><b>1.2.2</b> MLOps Lifecycle</a></li>
<li class="chapter" data-level="1.2.3" data-path="machine-learning-operations-mlops.html"><a href="machine-learning-operations-mlops.html#mlops-engineering"><i class="fa fa-check"></i><b>1.2.3</b> MLOps Engineering</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html"><i class="fa fa-check"></i><b>1.3</b> Roles and Tasks in MLOps</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-engineer"><i class="fa fa-check"></i><b>1.3.1</b> Data Engineer</a></li>
<li class="chapter" data-level="1.3.2" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#data-scientist"><i class="fa fa-check"></i><b>1.3.2</b> Data Scientist</a></li>
<li class="chapter" data-level="1.3.3" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#ml-engineer"><i class="fa fa-check"></i><b>1.3.3</b> ML Engineer</a></li>
<li class="chapter" data-level="1.3.4" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#mlops-engineer"><i class="fa fa-check"></i><b>1.3.4</b> MLOps Engineer</a></li>
<li class="chapter" data-level="1.3.5" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#devops-engineer"><i class="fa fa-check"></i><b>1.3.5</b> DevOps Engineer</a></li>
<li class="chapter" data-level="1.3.6" data-path="roles-and-tasks-in-mlops.html"><a href="roles-and-tasks-in-mlops.html#additional-roles-function"><i class="fa fa-check"></i><b>1.3.6</b> Additional roles &amp; function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ops-tools-and-principles.html"><a href="ops-tools-and-principles.html"><i class="fa fa-check"></i><b>2</b> Ops Tools and Principles</a>
<ul>
<li class="chapter" data-level="2.1" data-path="containerization.html"><a href="containerization.html"><i class="fa fa-check"></i><b>2.1</b> Containerization</a></li>
<li class="chapter" data-level="2.2" data-path="version-control.html"><a href="version-control.html"><i class="fa fa-check"></i><b>2.2</b> Version Control</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="version-control.html"><a href="version-control.html#github"><i class="fa fa-check"></i><b>2.2.1</b> Github</a></li>
<li class="chapter" data-level="2.2.2" data-path="version-control.html"><a href="version-control.html#git-lifecycle"><i class="fa fa-check"></i><b>2.2.2</b> Git lifecycle</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="cicd.html"><a href="cicd.html"><i class="fa fa-check"></i><b>2.3</b> CI/CD</a>
<ul>
<li class="chapter" data-level="" data-path="cicd.html"><a href="cicd.html#github-actions"><i class="fa fa-check"></i>Github Actions</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="infrastructure-as-code.html"><a href="infrastructure-as-code.html"><i class="fa fa-check"></i><b>2.4</b> Infrastructure as code</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="airflow.html"><a href="airflow.html"><i class="fa fa-check"></i><b>3</b> Airflow</a>
<ul>
<li class="chapter" data-level="3.1" data-path="core-components.html"><a href="core-components.html"><i class="fa fa-check"></i><b>3.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="core-components.html"><a href="core-components.html#dags"><i class="fa fa-check"></i><b>3.1.1</b> DAGs</a></li>
<li class="chapter" data-level="3.1.2" data-path="core-components.html"><a href="core-components.html#operators"><i class="fa fa-check"></i><b>3.1.2</b> Operators</a></li>
<li class="chapter" data-level="3.1.3" data-path="core-components.html"><a href="core-components.html#tasks"><i class="fa fa-check"></i><b>3.1.3</b> Tasks</a></li>
<li class="chapter" data-level="3.1.4" data-path="core-components.html"><a href="core-components.html#xcom"><i class="fa fa-check"></i><b>3.1.4</b> XCom</a></li>
<li class="chapter" data-level="3.1.5" data-path="core-components.html"><a href="core-components.html#scheduling"><i class="fa fa-check"></i><b>3.1.5</b> Scheduling</a></li>
<li class="chapter" data-level="3.1.6" data-path="core-components.html"><a href="core-components.html#taskflow"><i class="fa fa-check"></i><b>3.1.6</b> Taskflow</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="exemplary-ml-workflow.html"><a href="exemplary-ml-workflow.html"><i class="fa fa-check"></i><b>3.2</b> Exemplary ML workflow</a></li>
<li class="chapter" data-level="3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html"><i class="fa fa-check"></i><b>3.3</b> Airflow infrastructure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#airflow-as-a-distributed-system"><i class="fa fa-check"></i><b>3.3.1</b> Airflow as a distributed system</a></li>
<li class="chapter" data-level="3.3.2" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#scheduler"><i class="fa fa-check"></i><b>3.3.2</b> Scheduler</a></li>
<li class="chapter" data-level="3.3.3" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#webserver"><i class="fa fa-check"></i><b>3.3.3</b> Webserver</a></li>
<li class="chapter" data-level="3.3.4" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#executor"><i class="fa fa-check"></i><b>3.3.4</b> Executor</a></li>
<li class="chapter" data-level="3.3.5" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#dag-directory"><i class="fa fa-check"></i><b>3.3.5</b> DAG Directory</a></li>
<li class="chapter" data-level="3.3.6" data-path="airflow-infrastructure.html"><a href="airflow-infrastructure.html#metadata-database"><i class="fa fa-check"></i><b>3.3.6</b> Metadata Database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mlflow.html"><a href="mlflow.html"><i class="fa fa-check"></i><b>4</b> MLflow</a>
<ul>
<li class="chapter" data-level="4.1" data-path="core-components-1.html"><a href="core-components-1.html"><i class="fa fa-check"></i><b>4.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-tracking"><i class="fa fa-check"></i><b>4.1.1</b> MLflow Tracking</a></li>
<li class="chapter" data-level="4.1.2" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-models"><i class="fa fa-check"></i><b>4.1.2</b> MLflow Models</a></li>
<li class="chapter" data-level="4.1.3" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-model-registry"><i class="fa fa-check"></i><b>4.1.3</b> MLflow Model Registry</a></li>
<li class="chapter" data-level="4.1.4" data-path="core-components-1.html"><a href="core-components-1.html#mlflow-projects"><i class="fa fa-check"></i><b>4.1.4</b> MLflow Projects</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html"><i class="fa fa-check"></i><b>4.2</b> MLFflow Architecture</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-tracking-server"><i class="fa fa-check"></i><b>4.2.1</b> MLflow Tracking Server</a></li>
<li class="chapter" data-level="4.2.2" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-backend-store"><i class="fa fa-check"></i><b>4.2.2</b> MLflow Backend Store</a></li>
<li class="chapter" data-level="4.2.3" data-path="mlfflow-architecture.html"><a href="mlfflow-architecture.html#mlflow-artifact-store"><i class="fa fa-check"></i><b>4.2.3</b> MLflow Artifact Store</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="kubernetes.html"><a href="kubernetes.html"><i class="fa fa-check"></i><b>5</b> Kubernetes</a>
<ul>
<li class="chapter" data-level="5.1" data-path="core-components-2.html"><a href="core-components-2.html"><i class="fa fa-check"></i><b>5.1</b> Core Components</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="core-components-2.html"><a href="core-components-2.html#nodes"><i class="fa fa-check"></i><b>5.1.1</b> Nodes</a></li>
<li class="chapter" data-level="5.1.2" data-path="core-components-2.html"><a href="core-components-2.html#pods"><i class="fa fa-check"></i><b>5.1.2</b> Pods</a></li>
<li class="chapter" data-level="5.1.3" data-path="core-components-2.html"><a href="core-components-2.html#imperative-declarative-management"><i class="fa fa-check"></i><b>5.1.3</b> Imperative &amp; Declarative Management</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html"><i class="fa fa-check"></i><b>5.2</b> Application Deployment &amp; Design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="application-deployment-design.html"><a href="application-deployment-design.html#deployments"><i class="fa fa-check"></i><b>5.2.1</b> Deployments</a></li>
<li class="chapter" data-level="5.2.2" data-path="application-deployment-design.html"><a href="application-deployment-design.html#resource-management"><i class="fa fa-check"></i><b>5.2.2</b> Resource Management</a></li>
<li class="chapter" data-level="5.2.3" data-path="application-deployment-design.html"><a href="application-deployment-design.html#daemonsets"><i class="fa fa-check"></i><b>5.2.3</b> DaemonSets</a></li>
<li class="chapter" data-level="5.2.4" data-path="application-deployment-design.html"><a href="application-deployment-design.html#statefulsets"><i class="fa fa-check"></i><b>5.2.4</b> StatefulSets</a></li>
<li class="chapter" data-level="5.2.5" data-path="application-deployment-design.html"><a href="application-deployment-design.html#jobs-cron-jobs"><i class="fa fa-check"></i><b>5.2.5</b> Jobs &amp; Cron Jobs</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="services-and-networking.html"><a href="services-and-networking.html"><i class="fa fa-check"></i><b>5.3</b> Services and Networking</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="services-and-networking.html"><a href="services-and-networking.html#services"><i class="fa fa-check"></i><b>5.3.1</b> Services</a></li>
<li class="chapter" data-level="5.3.2" data-path="services-and-networking.html"><a href="services-and-networking.html#service-discovery"><i class="fa fa-check"></i><b>5.3.2</b> Service Discovery</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html"><i class="fa fa-check"></i><b>5.4</b> Volumes and Storage</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#emptydir-volume"><i class="fa fa-check"></i><b>5.4.1</b> EmptyDir Volume</a></li>
<li class="chapter" data-level="5.4.2" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#hostpath-volume"><i class="fa fa-check"></i><b>5.4.2</b> HostPath Volume</a></li>
<li class="chapter" data-level="5.4.3" data-path="volumes-and-storage.html"><a href="volumes-and-storage.html#persistent-volumes"><i class="fa fa-check"></i><b>5.4.3</b> Persistent Volumes</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html"><i class="fa fa-check"></i><b>5.5</b> Environment, Configuration &amp; Security</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#namespaces"><i class="fa fa-check"></i><b>5.5.1</b> Namespaces</a></li>
<li class="chapter" data-level="5.5.2" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#labels-selectors-and-annotations"><i class="fa fa-check"></i><b>5.5.2</b> Labels, Selectors and Annotations</a></li>
<li class="chapter" data-level="5.5.3" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#configmaps"><i class="fa fa-check"></i><b>5.5.3</b> ConfigMaps</a></li>
<li class="chapter" data-level="5.5.4" data-path="environment-configuration-security.html"><a href="environment-configuration-security.html#secrets"><i class="fa fa-check"></i><b>5.5.4</b> Secrets</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="observability-maintenance.html"><a href="observability-maintenance.html"><i class="fa fa-check"></i><b>5.6</b> Observability &amp; Maintenance</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="observability-maintenance.html"><a href="observability-maintenance.html#health-checks"><i class="fa fa-check"></i><b>5.6.1</b> Health Checks</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="helm.html"><a href="helm.html"><i class="fa fa-check"></i><b>5.7</b> Helm</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="helm.html"><a href="helm.html#helm-chart-structure"><i class="fa fa-check"></i><b>5.7.1</b> Helm Chart Structure</a></li>
<li class="chapter" data-level="5.7.2" data-path="helm.html"><a href="helm.html#working-with-helm"><i class="fa fa-check"></i><b>5.7.2</b> Working with Helm</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="terraform.html"><a href="terraform.html"><i class="fa fa-check"></i><b>6</b> Terraform</a>
<ul>
<li class="chapter" data-level="6.1" data-path="basic-usage.html"><a href="basic-usage.html"><i class="fa fa-check"></i><b>6.1</b> Basic usage</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="basic-usage.html"><a href="basic-usage.html#terraform-init"><i class="fa fa-check"></i><b>6.1.1</b> terraform init</a></li>
<li class="chapter" data-level="6.1.2" data-path="basic-usage.html"><a href="basic-usage.html#terraform-validate"><i class="fa fa-check"></i><b>6.1.2</b> terraform validate</a></li>
<li class="chapter" data-level="6.1.3" data-path="basic-usage.html"><a href="basic-usage.html#terraform-plan"><i class="fa fa-check"></i><b>6.1.3</b> terraform plan</a></li>
<li class="chapter" data-level="6.1.4" data-path="basic-usage.html"><a href="basic-usage.html#terraform-apply"><i class="fa fa-check"></i><b>6.1.4</b> terraform apply</a></li>
<li class="chapter" data-level="6.1.5" data-path="basic-usage.html"><a href="basic-usage.html#terraform-destroy"><i class="fa fa-check"></i><b>6.1.5</b> terraform destroy</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="core-components-3.html"><a href="core-components-3.html"><i class="fa fa-check"></i><b>6.2</b> Core Components</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="core-components-3.html"><a href="core-components-3.html#providers"><i class="fa fa-check"></i><b>6.2.1</b> Providers</a></li>
<li class="chapter" data-level="6.2.2" data-path="core-components-3.html"><a href="core-components-3.html#resources"><i class="fa fa-check"></i><b>6.2.2</b> Resources</a></li>
<li class="chapter" data-level="6.2.3" data-path="core-components-3.html"><a href="core-components-3.html#data-sources"><i class="fa fa-check"></i><b>6.2.3</b> Data Sources</a></li>
<li class="chapter" data-level="6.2.4" data-path="core-components-3.html"><a href="core-components-3.html#state"><i class="fa fa-check"></i><b>6.2.4</b> State</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="modules.html"><a href="modules.html"><i class="fa fa-check"></i><b>6.3</b> Modules</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="modules.html"><a href="modules.html#input-variables"><i class="fa fa-check"></i><b>6.3.1</b> Input Variables</a></li>
<li class="chapter" data-level="6.3.2" data-path="modules.html"><a href="modules.html#output-variables"><i class="fa fa-check"></i><b>6.3.2</b> Output Variables</a></li>
<li class="chapter" data-level="6.3.3" data-path="modules.html"><a href="modules.html#local-variables"><i class="fa fa-check"></i><b>6.3.3</b> Local Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html"><i class="fa fa-check"></i><b>6.4</b> Additional tips &amp; tricks</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#count"><i class="fa fa-check"></i><b>6.4.1</b> count</a></li>
<li class="chapter" data-level="6.4.2" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for-each"><i class="fa fa-check"></i><b>6.4.2</b> for-each</a></li>
<li class="chapter" data-level="6.4.3" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#for"><i class="fa fa-check"></i><b>6.4.3</b> for</a></li>
<li class="chapter" data-level="6.4.4" data-path="additional-tips-tricks.html"><a href="additional-tips-tricks.html#workspaces"><i class="fa fa-check"></i><b>6.4.4</b> Workspaces</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html"><i class="fa fa-check"></i><b>6.5</b> Exemplary Deployment</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#root"><i class="fa fa-check"></i><b>6.5.1</b> root</a></li>
<li class="chapter" data-level="6.5.2" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#vpc"><i class="fa fa-check"></i><b>6.5.2</b> vpc</a></li>
<li class="chapter" data-level="6.5.3" data-path="exemplary-deployment.html"><a href="exemplary-deployment.html#run-the-code"><i class="fa fa-check"></i><b>6.5.3</b> Run the code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ml-platform-design.html"><a href="ml-platform-design.html"><i class="fa fa-check"></i><b>7</b> ML Platform Design</a>
<ul>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#infrastructure"><i class="fa fa-check"></i>Infrastructure</a></li>
<li class="chapter" data-level="" data-path="ml-platform-design.html"><a href="ml-platform-design.html#mlops-tools"><i class="fa fa-check"></i>MLOps Tools</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="platform-deployment.html"><a href="platform-deployment.html"><i class="fa fa-check"></i><b>8</b> Platform Deployment</a>
<ul>
<li class="chapter" data-level="8.1" data-path="root-module.html"><a href="root-module.html"><i class="fa fa-check"></i><b>8.1</b> Root module</a></li>
<li class="chapter" data-level="8.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html"><i class="fa fa-check"></i><b>8.2</b> Infrastructure</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="infrastructure-2.html"><a href="infrastructure-2.html#virtual-private-cloud"><i class="fa fa-check"></i><b>8.2.1</b> Virtual Private Cloud</a></li>
<li class="chapter" data-level="8.2.2" data-path="infrastructure-2.html"><a href="infrastructure-2.html#elastic-kubernetes-service"><i class="fa fa-check"></i><b>8.2.2</b> Elastic Kubernetes Service</a></li>
<li class="chapter" data-level="8.2.3" data-path="infrastructure-2.html"><a href="infrastructure-2.html#networking"><i class="fa fa-check"></i><b>8.2.3</b> Networking</a></li>
<li class="chapter" data-level="8.2.4" data-path="infrastructure-2.html"><a href="infrastructure-2.html#relational-database-service"><i class="fa fa-check"></i><b>8.2.4</b> Relational Database Service</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>8.3</b> Components</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="components.html"><a href="components.html#user-profiles"><i class="fa fa-check"></i><b>8.3.1</b> User Profiles</a></li>
<li class="chapter" data-level="8.3.2" data-path="components.html"><a href="components.html#airflow-1"><i class="fa fa-check"></i><b>8.3.2</b> Airflow</a></li>
<li class="chapter" data-level="8.3.3" data-path="components.html"><a href="components.html#mlflow-1"><i class="fa fa-check"></i><b>8.3.3</b> Mlflow</a></li>
<li class="chapter" data-level="8.3.4" data-path="components.html"><a href="components.html#jupyterhub"><i class="fa fa-check"></i><b>8.3.4</b> Jupyterhub</a></li>
<li class="chapter" data-level="8.3.5" data-path="components.html"><a href="components.html#monitoring"><i class="fa fa-check"></i><b>8.3.5</b> Monitoring</a></li>
<li class="chapter" data-level="8.3.6" data-path="components.html"><a href="components.html#sagemaker"><i class="fa fa-check"></i><b>8.3.6</b> Sagemaker</a></li>
<li class="chapter" data-level="8.3.7" data-path="components.html"><a href="components.html#dashboard"><i class="fa fa-check"></i><b>8.3.7</b> Dashboard</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="design-decisions.html"><a href="design-decisions.html"><i class="fa fa-check"></i><b>8.4</b> Design Decisions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="use-case-development.html"><a href="use-case-development.html"><i class="fa fa-check"></i><b>9</b> Use Case Development</a>
<ul>
<li class="chapter" data-level="9.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html"><i class="fa fa-check"></i><b>9.1</b> Integrated Development Environment</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="integrated-development-environment-1.html"><a href="integrated-development-environment-1.html#github-repository"><i class="fa fa-check"></i><b>9.1.1</b> Github Repository</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html"><i class="fa fa-check"></i><b>9.2</b> Training &amp; Deployment Pipeline Workflow</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#airflow-workflow"><i class="fa fa-check"></i><b>9.2.1</b> Airflow Workflow</a></li>
<li class="chapter" data-level="9.2.2" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#mlflow-integration"><i class="fa fa-check"></i><b>9.2.2</b> MLflow integration</a></li>
<li class="chapter" data-level="9.2.3" data-path="training-deployment-pipeline-workflow.html"><a href="training-deployment-pipeline-workflow.html#pipeline-workflow"><i class="fa fa-check"></i><b>9.2.3</b> Pipeline Workflow</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html"><i class="fa fa-check"></i><b>9.3</b> Pipeline Workflow Steps</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#data-preprocessing"><i class="fa fa-check"></i><b>9.3.1</b> Data Preprocessing</a></li>
<li class="chapter" data-level="9.3.2" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-training"><i class="fa fa-check"></i><b>9.3.2</b> Model Training</a></li>
<li class="chapter" data-level="9.3.3" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-comparison"><i class="fa fa-check"></i><b>9.3.3</b> Model Comparison</a></li>
<li class="chapter" data-level="9.3.4" data-path="pipeline-workflow-steps.html"><a href="pipeline-workflow-steps.html#model-deployment-serving"><i class="fa fa-check"></i><b>9.3.4</b> Model Deployment &amp; Serving</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="model-inferencing.html"><a href="model-inferencing.html"><i class="fa fa-check"></i><b>9.4</b> Model Inferencing</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="model-inferencing.html"><a href="model-inferencing.html#pipeline-workflow-1"><i class="fa fa-check"></i><b>9.4.1</b> Pipeline Workflow</a></li>
<li class="chapter" data-level="9.4.2" data-path="model-inferencing.html"><a href="model-inferencing.html#inference-workflow-code"><i class="fa fa-check"></i><b>9.4.2</b> Inference Workflow Code</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i>Glossary</a></li>
<li class="chapter" data-level="" data-path="contributing.html"><a href="contributing.html"><i class="fa fa-check"></i>Contributing</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MLOps Engineering</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-inferencing" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Model Inferencing<a href="model-inferencing.html#model-inferencing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For testing model inference, there is a separate Airflow DAG tailored specifically for conducting inference tests on a CNN SageMaker deployment. This DAG is responsible for various tasks, including verifying the status of the SageMaker endpoint, handling multiple sample images for inference, and retrieving predictions from the endpoint. The configuration of this DAG includes essential metadata and execution parameters.</p>
<div id="pipeline-workflow-1" class="section level3 hasAnchor" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Pipeline Workflow<a href="model-inferencing.html#pipeline-workflow-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to the <code>cnn_skin_cancer_workflow</code> DAG, this code commences by importing the necessary modules and libraries required for the Airflow DAG. Furthermore, it configures specific parameters, including the <code>skin_cancer_container_image</code>, which represents the container image used for Kubernetes pods, and the <code>SECRET_AWS_REGION</code>, a secret housing AWS region information, later passed to the container as an environment variable.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb186-1"><a href="model-inferencing.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pendulum</span>
<span id="cb186-2"><a href="model-inferencing.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.decorators <span class="im">import</span> dag, task</span>
<span id="cb186-3"><a href="model-inferencing.html#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.kubernetes.secret <span class="im">import</span> Secret</span>
<span id="cb186-4"><a href="model-inferencing.html#cb186-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airflow.models <span class="im">import</span> Variable</span>
<span id="cb186-5"><a href="model-inferencing.html#cb186-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-6"><a href="model-inferencing.html#cb186-6" aria-hidden="true" tabindex="-1"></a><span class="co"># SET PARAMETERS</span></span>
<span id="cb186-7"><a href="model-inferencing.html#cb186-7" aria-hidden="true" tabindex="-1"></a>skin_cancer_container_image <span class="op">=</span> <span class="st">&quot;seblum/cnn-skin-cancer-model:latest&quot;</span>  <span class="co"># base image for k8s pods</span></span>
<span id="cb186-8"><a href="model-inferencing.html#cb186-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-9"><a href="model-inferencing.html#cb186-9" aria-hidden="true" tabindex="-1"></a>SECRET_AWS_REGION <span class="op">=</span> Secret(</span>
<span id="cb186-10"><a href="model-inferencing.html#cb186-10" aria-hidden="true" tabindex="-1"></a>    deploy_type<span class="op">=</span><span class="st">&quot;env&quot;</span>, deploy_target<span class="op">=</span><span class="st">&quot;AWS_REGION&quot;</span>, secret<span class="op">=</span><span class="st">&quot;airflow-aws-account-information&quot;</span>, key<span class="op">=</span><span class="st">&quot;AWS_REGION&quot;</span></span>
<span id="cb186-11"><a href="model-inferencing.html#cb186-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>The Airflow DAG itself, named <code>cnn_skin_cancer_sagemaker_inference_test</code>, is then defined, complete with its metadata, scheduling details, and associated tasks. Within this DAG definition, there exists an inference task known as <code>inference_call_op</code>, which is established using the <code>@task.kubernetes</code> decorator. This task is responsible for conducting inference on a SageMaker endpoint, processing multiple images. It is configured with the previously defined secret and container image.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb187-1"><a href="model-inferencing.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="at">@dag</span>(</span>
<span id="cb187-2"><a href="model-inferencing.html#cb187-2" aria-hidden="true" tabindex="-1"></a>    dag_id<span class="op">=</span><span class="st">&quot;cnn_skin_cancer_sagemaker_test_inference&quot;</span>,</span>
<span id="cb187-3"><a href="model-inferencing.html#cb187-3" aria-hidden="true" tabindex="-1"></a>    default_args<span class="op">=</span>{</span>
<span id="cb187-4"><a href="model-inferencing.html#cb187-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;owner&quot;</span>: <span class="st">&quot;seblum&quot;</span>,</span>
<span id="cb187-5"><a href="model-inferencing.html#cb187-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;depends_on_past&quot;</span>: <span class="va">False</span>,</span>
<span id="cb187-6"><a href="model-inferencing.html#cb187-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;start_date&quot;</span>: pendulum.datetime(<span class="dv">2021</span>, <span class="dv">1</span>, <span class="dv">1</span>, tz<span class="op">=</span><span class="st">&quot;Europe/Amsterdam&quot;</span>),</span>
<span id="cb187-7"><a href="model-inferencing.html#cb187-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;tags&quot;</span>: [<span class="st">&quot;Inference test on CNN sagemaker deployment&quot;</span>],</span>
<span id="cb187-8"><a href="model-inferencing.html#cb187-8" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb187-9"><a href="model-inferencing.html#cb187-9" aria-hidden="true" tabindex="-1"></a>    schedule_interval<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb187-10"><a href="model-inferencing.html#cb187-10" aria-hidden="true" tabindex="-1"></a>    max_active_runs<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb187-11"><a href="model-inferencing.html#cb187-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb187-12"><a href="model-inferencing.html#cb187-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cnn_skin_cancer_sagemaker_inference_test():</span>
<span id="cb187-13"><a href="model-inferencing.html#cb187-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb187-14"><a href="model-inferencing.html#cb187-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Apache Airflow DAG for testing inference on a CNN SageMaker deployment.</span></span>
<span id="cb187-15"><a href="model-inferencing.html#cb187-15" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb187-16"><a href="model-inferencing.html#cb187-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">@task.kubernetes</span>(</span>
<span id="cb187-17"><a href="model-inferencing.html#cb187-17" aria-hidden="true" tabindex="-1"></a>        image<span class="op">=</span>skin_cancer_container_image,</span>
<span id="cb187-18"><a href="model-inferencing.html#cb187-18" aria-hidden="true" tabindex="-1"></a>        task_id<span class="op">=</span><span class="st">&quot;inference_call_op&quot;</span>,</span>
<span id="cb187-19"><a href="model-inferencing.html#cb187-19" aria-hidden="true" tabindex="-1"></a>        namespace<span class="op">=</span><span class="st">&quot;airflow&quot;</span>,</span>
<span id="cb187-20"><a href="model-inferencing.html#cb187-20" aria-hidden="true" tabindex="-1"></a>        in_cluster<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb187-21"><a href="model-inferencing.html#cb187-21" aria-hidden="true" tabindex="-1"></a>        get_logs<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb187-22"><a href="model-inferencing.html#cb187-22" aria-hidden="true" tabindex="-1"></a>        startup_timeout_seconds<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb187-23"><a href="model-inferencing.html#cb187-23" aria-hidden="true" tabindex="-1"></a>        service_account_name<span class="op">=</span><span class="st">&quot;airflow-sa&quot;</span>,</span>
<span id="cb187-24"><a href="model-inferencing.html#cb187-24" aria-hidden="true" tabindex="-1"></a>        secrets<span class="op">=</span>[</span>
<span id="cb187-25"><a href="model-inferencing.html#cb187-25" aria-hidden="true" tabindex="-1"></a>            SECRET_AWS_REGION,</span>
<span id="cb187-26"><a href="model-inferencing.html#cb187-26" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb187-27"><a href="model-inferencing.html#cb187-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb187-28"><a href="model-inferencing.html#cb187-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inference_call_op():</span>
<span id="cb187-29"><a href="model-inferencing.html#cb187-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb187-30"><a href="model-inferencing.html#cb187-30" aria-hidden="true" tabindex="-1"></a><span class="co">        Perform inference on a SageMaker endpoint with multiple images.</span></span>
<span id="cb187-31"><a href="model-inferencing.html#cb187-31" aria-hidden="true" tabindex="-1"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb187-32"><a href="model-inferencing.html#cb187-32" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> json</span>
<span id="cb187-33"><a href="model-inferencing.html#cb187-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-34"><a href="model-inferencing.html#cb187-34" aria-hidden="true" tabindex="-1"></a>        <span class="im">from</span> src.inference_to_sagemaker <span class="im">import</span> (</span>
<span id="cb187-35"><a href="model-inferencing.html#cb187-35" aria-hidden="true" tabindex="-1"></a>            endpoint_status,</span>
<span id="cb187-36"><a href="model-inferencing.html#cb187-36" aria-hidden="true" tabindex="-1"></a>            get_image_directory,</span>
<span id="cb187-37"><a href="model-inferencing.html#cb187-37" aria-hidden="true" tabindex="-1"></a>            preprocess_image,</span>
<span id="cb187-38"><a href="model-inferencing.html#cb187-38" aria-hidden="true" tabindex="-1"></a>            query_endpoint,</span>
<span id="cb187-39"><a href="model-inferencing.html#cb187-39" aria-hidden="true" tabindex="-1"></a>            read_imagefile,</span>
<span id="cb187-40"><a href="model-inferencing.html#cb187-40" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<p>Inside the <code>inference_call_op</code> task, a sequence of actions takes place, encompassing SageMaker endpoint status verification, image data preparation, image preprocessing, and the actual inference process. Since the Airflow workflow comprises only a single step, the function is called directly following its definition. Subsequently, the DAG is executed by invoking the <code>cnn_skin_cancer_sagemaker_inference_test()</code> function.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb188-1"><a href="model-inferencing.html#cb188-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-2"><a href="model-inferencing.html#cb188-2" aria-hidden="true" tabindex="-1"></a>        sagemaker_endpoint_name <span class="op">=</span> <span class="st">&quot;test-cnn-skin-cancer&quot;</span></span>
<span id="cb188-3"><a href="model-inferencing.html#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="model-inferencing.html#cb188-4" aria-hidden="true" tabindex="-1"></a>        image_directoy <span class="op">=</span> get_image_directory()</span>
<span id="cb188-5"><a href="model-inferencing.html#cb188-5" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Image directory: </span><span class="sc">{</span>image_directoy<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb188-6"><a href="model-inferencing.html#cb188-6" aria-hidden="true" tabindex="-1"></a>        filenames <span class="op">=</span> [<span class="st">&quot;1.jpg&quot;</span>, <span class="st">&quot;10.jpg&quot;</span>, <span class="st">&quot;1003.jpg&quot;</span>, <span class="st">&quot;1005.jpg&quot;</span>, <span class="st">&quot;1007.jpg&quot;</span>]</span>
<span id="cb188-7"><a href="model-inferencing.html#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="model-inferencing.html#cb188-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> filenames:</span>
<span id="cb188-9"><a href="model-inferencing.html#cb188-9" aria-hidden="true" tabindex="-1"></a>            filepath <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>image_directoy<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb188-10"><a href="model-inferencing.html#cb188-10" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[+] New Inference&quot;</span>)</span>
<span id="cb188-11"><a href="model-inferencing.html#cb188-11" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;[+] FilePath is </span><span class="sc">{</span>filepath<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb188-12"><a href="model-inferencing.html#cb188-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-13"><a href="model-inferencing.html#cb188-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Check endpoint status</span></span>
<span id="cb188-14"><a href="model-inferencing.html#cb188-14" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;[+] Endpoint Status&quot;</span>)</span>
<span id="cb188-15"><a href="model-inferencing.html#cb188-15" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Application status is </span><span class="sc">{</span>endpoint_status(sagemaker_endpoint_name)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb188-16"><a href="model-inferencing.html#cb188-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-17"><a href="model-inferencing.html#cb188-17" aria-hidden="true" tabindex="-1"></a>            image <span class="op">=</span> read_imagefile(filepath)</span>
<span id="cb188-18"><a href="model-inferencing.html#cb188-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-19"><a href="model-inferencing.html#cb188-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;[+] Preprocess Data&quot;</span>)</span>
<span id="cb188-20"><a href="model-inferencing.html#cb188-20" aria-hidden="true" tabindex="-1"></a>            np_image <span class="op">=</span> preprocess_image(image)</span>
<span id="cb188-21"><a href="model-inferencing.html#cb188-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-22"><a href="model-inferencing.html#cb188-22" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add instances fiels so np_image can be inferenced by MLflow model</span></span>
<span id="cb188-23"><a href="model-inferencing.html#cb188-23" aria-hidden="true" tabindex="-1"></a>            payload <span class="op">=</span> json.dumps({<span class="st">&quot;instances&quot;</span>: np_image.tolist()})</span>
<span id="cb188-24"><a href="model-inferencing.html#cb188-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-25"><a href="model-inferencing.html#cb188-25" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">&quot;[+] Prediction&quot;</span>)</span>
<span id="cb188-26"><a href="model-inferencing.html#cb188-26" aria-hidden="true" tabindex="-1"></a>            predictions <span class="op">=</span> query_endpoint(app_name<span class="op">=</span>sagemaker_endpoint_name, data<span class="op">=</span>payload)</span>
<span id="cb188-27"><a href="model-inferencing.html#cb188-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f&quot;Received response for </span><span class="sc">{</span><span class="bu">file</span><span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>predictions<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb188-28"><a href="model-inferencing.html#cb188-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-29"><a href="model-inferencing.html#cb188-29" aria-hidden="true" tabindex="-1"></a>    inference_call_op()</span>
<span id="cb188-30"><a href="model-inferencing.html#cb188-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-31"><a href="model-inferencing.html#cb188-31" aria-hidden="true" tabindex="-1"></a>cnn_skin_cancer_sagemaker_inference_test()</span></code></pre></div>
</div>
<div id="inference-workflow-code" class="section level3 hasAnchor" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Inference Workflow Code<a href="model-inferencing.html#inference-workflow-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Collectively, these functions provide comprehensive support for testing and interacting with an Amazon SageMaker endpoint. Their functionality encompasses tasks such as image data preparation and processing, endpoint status verification, and querying the endpoint to obtain predictions or responses.</p>
<div id="get_image_directory-function" class="section level5 hasAnchor" number="9.4.2.0.1">
<h5><span class="header-section-number">9.4.2.0.1</span> <code>get_image_directory</code> Function<a href="model-inferencing.html#get_image_directory-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>This function is responsible for retrieving the absolute file path for the inference_test_images directory, relative to the current scripts location.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb189-1"><a href="model-inferencing.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_image_directory() <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb189-2"><a href="model-inferencing.html#cb189-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb189-3"><a href="model-inferencing.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Get the file path for the &#39;inference_test_images&#39; directory relative to the current script&#39;s location.</span></span>
<span id="cb189-4"><a href="model-inferencing.html#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="model-inferencing.html#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb189-6"><a href="model-inferencing.html#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The absolute file path to the &#39;inference_test_images&#39; directory.</span></span>
<span id="cb189-7"><a href="model-inferencing.html#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb189-8"><a href="model-inferencing.html#cb189-8" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="ss">f&quot;</span><span class="sc">{</span>Path(<span class="va">__file__</span>)<span class="sc">.</span>parent<span class="sc">.</span>parent<span class="sc">}</span><span class="ss">/inference_test_images&quot;</span></span>
<span id="cb189-9"><a href="model-inferencing.html#cb189-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> path</span></code></pre></div>
</div>
<div id="read_imagefile-function" class="section level5 hasAnchor" number="9.4.2.0.2">
<h5><span class="header-section-number">9.4.2.0.2</span> <code>read_imagefile</code> Function<a href="model-inferencing.html#read_imagefile-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <code>read_imagefile</code> function is designed to read an image file, which can be either from a file path or binary data, and return it as a PIL <code>JpegImageFile</code> object.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb190-1"><a href="model-inferencing.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_imagefile(data: <span class="bu">str</span>) <span class="op">-&gt;</span> JpegImageFile:</span>
<span id="cb190-2"><a href="model-inferencing.html#cb190-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb190-3"><a href="model-inferencing.html#cb190-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads an image file and returns it as a PIL JpegImageFile object.</span></span>
<span id="cb190-4"><a href="model-inferencing.html#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="model-inferencing.html#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb190-6"><a href="model-inferencing.html#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="co">        data (str): The file path or binary data representing the image.</span></span>
<span id="cb190-7"><a href="model-inferencing.html#cb190-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-8"><a href="model-inferencing.html#cb190-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb190-9"><a href="model-inferencing.html#cb190-9" aria-hidden="true" tabindex="-1"></a><span class="co">        PIL.JpegImagePlugin.JpegImageFile: A PIL JpegImageFile object representing the image.</span></span>
<span id="cb190-10"><a href="model-inferencing.html#cb190-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-11"><a href="model-inferencing.html#cb190-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb190-12"><a href="model-inferencing.html#cb190-12" aria-hidden="true" tabindex="-1"></a><span class="co">        # Read an image file from a file path</span></span>
<span id="cb190-13"><a href="model-inferencing.html#cb190-13" aria-hidden="true" tabindex="-1"></a><span class="co">        image_path = &quot;example.jpg&quot;</span></span>
<span id="cb190-14"><a href="model-inferencing.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="co">        image = read_imagefile(image_path)</span></span>
<span id="cb190-15"><a href="model-inferencing.html#cb190-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-16"><a href="model-inferencing.html#cb190-16" aria-hidden="true" tabindex="-1"></a><span class="co">        # Read an image file from binary data</span></span>
<span id="cb190-17"><a href="model-inferencing.html#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="co">        with open(&quot;example.jpg&quot;, &quot;rb&quot;) as file:</span></span>
<span id="cb190-18"><a href="model-inferencing.html#cb190-18" aria-hidden="true" tabindex="-1"></a><span class="co">            binary_data = file.read()</span></span>
<span id="cb190-19"><a href="model-inferencing.html#cb190-19" aria-hidden="true" tabindex="-1"></a><span class="co">        image = read_imagefile(binary_data)</span></span>
<span id="cb190-20"><a href="model-inferencing.html#cb190-20" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb190-21"><a href="model-inferencing.html#cb190-21" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> Image.<span class="bu">open</span>(data)</span>
<span id="cb190-22"><a href="model-inferencing.html#cb190-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span></code></pre></div>
</div>
<div id="preprocess_image-function" class="section level5 hasAnchor" number="9.4.2.0.3">
<h5><span class="header-section-number">9.4.2.0.3</span> <code>preprocess_image</code> Function<a href="model-inferencing.html#preprocess_image-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <code>preprocess_image</code> function plays a crucial role in preprocessing a JPEG image for deep learning models. It performs several operations, including converting the image to a NumPy array, scaling its values to fall within the 0 to 1 range, and reshaping it to match the expected input shape for the model.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb191-1"><a href="model-inferencing.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_image(image: JpegImageFile) <span class="op">-&gt;</span> np.array:</span>
<span id="cb191-2"><a href="model-inferencing.html#cb191-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb191-3"><a href="model-inferencing.html#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Preprocesses a JPEG image for deep learning models.</span></span>
<span id="cb191-4"><a href="model-inferencing.html#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="model-inferencing.html#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb191-6"><a href="model-inferencing.html#cb191-6" aria-hidden="true" tabindex="-1"></a><span class="co">        image (PIL.JpegImagePlugin.JpegImageFile): A PIL image object in JPEG format.</span></span>
<span id="cb191-7"><a href="model-inferencing.html#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="model-inferencing.html#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb191-9"><a href="model-inferencing.html#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="co">        np.ndarray: A NumPy array representing the preprocessed image.</span></span>
<span id="cb191-10"><a href="model-inferencing.html#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co">                    The image is converted to a NumPy array with data type &#39;uint8&#39;,</span></span>
<span id="cb191-11"><a href="model-inferencing.html#cb191-11" aria-hidden="true" tabindex="-1"></a><span class="co">                    scaled to values between 0 and 1, and reshaped to (1, 224, 224, 3).</span></span>
<span id="cb191-12"><a href="model-inferencing.html#cb191-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-13"><a href="model-inferencing.html#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb191-14"><a href="model-inferencing.html#cb191-14" aria-hidden="true" tabindex="-1"></a><span class="co">        # Load an image using PIL</span></span>
<span id="cb191-15"><a href="model-inferencing.html#cb191-15" aria-hidden="true" tabindex="-1"></a><span class="co">        image = Image.open(&quot;example.jpg&quot;)</span></span>
<span id="cb191-16"><a href="model-inferencing.html#cb191-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-17"><a href="model-inferencing.html#cb191-17" aria-hidden="true" tabindex="-1"></a><span class="co">        # Preprocess the image</span></span>
<span id="cb191-18"><a href="model-inferencing.html#cb191-18" aria-hidden="true" tabindex="-1"></a><span class="co">        preprocessed_image = preprocess_image(image)</span></span>
<span id="cb191-19"><a href="model-inferencing.html#cb191-19" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb191-20"><a href="model-inferencing.html#cb191-20" aria-hidden="true" tabindex="-1"></a>    np_image <span class="op">=</span> np.array(image, dtype<span class="op">=</span><span class="st">&quot;uint8&quot;</span>)</span>
<span id="cb191-21"><a href="model-inferencing.html#cb191-21" aria-hidden="true" tabindex="-1"></a>    np_image <span class="op">=</span> np_image <span class="op">/</span> <span class="fl">255.0</span></span>
<span id="cb191-22"><a href="model-inferencing.html#cb191-22" aria-hidden="true" tabindex="-1"></a>    np_image <span class="op">=</span> np_image.reshape(<span class="dv">1</span>, <span class="dv">224</span>, <span class="dv">224</span>, <span class="dv">3</span>)</span>
<span id="cb191-23"><a href="model-inferencing.html#cb191-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np_image</span></code></pre></div>
</div>
<div id="endpoint_status-function" class="section level5 hasAnchor" number="9.4.2.0.4">
<h5><span class="header-section-number">9.4.2.0.4</span> <code>endpoint_status</code> Function<a href="model-inferencing.html#endpoint_status-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <code>endpoint_status</code> function is responsible for checking the status of an Amazon SageMaker endpoint. It takes the <code>app_name</code> as input, which presumably represents the name or identifier of the endpoint.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb192-1"><a href="model-inferencing.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> endpoint_status(app_name: <span class="bu">str</span>) <span class="op">-&gt;</span> <span class="bu">str</span>:</span>
<span id="cb192-2"><a href="model-inferencing.html#cb192-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb192-3"><a href="model-inferencing.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Checks the status of an Amazon SageMaker endpoint.</span></span>
<span id="cb192-4"><a href="model-inferencing.html#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="model-inferencing.html#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb192-6"><a href="model-inferencing.html#cb192-6" aria-hidden="true" tabindex="-1"></a><span class="co">        app_name (str): The name of the SageMaker endpoint to check.</span></span>
<span id="cb192-7"><a href="model-inferencing.html#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="model-inferencing.html#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb192-9"><a href="model-inferencing.html#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="co">        str: The current status of the SageMaker endpoint.</span></span>
<span id="cb192-10"><a href="model-inferencing.html#cb192-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-11"><a href="model-inferencing.html#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb192-12"><a href="model-inferencing.html#cb192-12" aria-hidden="true" tabindex="-1"></a><span class="co">        # Check the status of a SageMaker endpoint</span></span>
<span id="cb192-13"><a href="model-inferencing.html#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint_name = &quot;my-endpoint&quot;</span></span>
<span id="cb192-14"><a href="model-inferencing.html#cb192-14" aria-hidden="true" tabindex="-1"></a><span class="co">        status = endpoint_status(endpoint_name)</span></span>
<span id="cb192-15"><a href="model-inferencing.html#cb192-15" aria-hidden="true" tabindex="-1"></a><span class="co">        print(f&quot;Endpoint status: {status}&quot;)</span></span>
<span id="cb192-16"><a href="model-inferencing.html#cb192-16" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb192-17"><a href="model-inferencing.html#cb192-17" aria-hidden="true" tabindex="-1"></a>    AWS_REGION <span class="op">=</span> os.getenv(<span class="st">&quot;AWS_REGION&quot;</span>)</span>
<span id="cb192-18"><a href="model-inferencing.html#cb192-18" aria-hidden="true" tabindex="-1"></a>    sage_client <span class="op">=</span> boto3.client(<span class="st">&quot;sagemaker&quot;</span>, region_name<span class="op">=</span>AWS_REGION)</span>
<span id="cb192-19"><a href="model-inferencing.html#cb192-19" aria-hidden="true" tabindex="-1"></a>    endpoint_description <span class="op">=</span> sage_client.describe_endpoint(EndpointName<span class="op">=</span>app_name)</span>
<span id="cb192-20"><a href="model-inferencing.html#cb192-20" aria-hidden="true" tabindex="-1"></a>    endpoint_status <span class="op">=</span> endpoint_description[<span class="st">&quot;EndpointStatus&quot;</span>]</span>
<span id="cb192-21"><a href="model-inferencing.html#cb192-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> endpoint_status</span></code></pre></div>
</div>
<div id="query_endpoint-function" class="section level5 hasAnchor" number="9.4.2.0.5">
<h5><span class="header-section-number">9.4.2.0.5</span> <code>query_endpoint</code> Function<a href="model-inferencing.html#query_endpoint-function" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The <code>query_endpoint</code> function is responsible for querying an Amazon SageMaker endpoint using input data provided in JSON format. It then retrieves predictions or responses from the endpoint based on the provided input.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb193-1"><a href="model-inferencing.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> query_endpoint(app_name: <span class="bu">str</span>, data: <span class="bu">str</span>) <span class="op">-&gt;</span> json:</span>
<span id="cb193-2"><a href="model-inferencing.html#cb193-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb193-3"><a href="model-inferencing.html#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Queries an Amazon SageMaker endpoint with input data and retrieves predictions.</span></span>
<span id="cb193-4"><a href="model-inferencing.html#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="model-inferencing.html#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb193-6"><a href="model-inferencing.html#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="co">        app_name (str): The name of the SageMaker endpoint to query.</span></span>
<span id="cb193-7"><a href="model-inferencing.html#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co">        data (str): Input data in JSON format to send to the endpoint.</span></span>
<span id="cb193-8"><a href="model-inferencing.html#cb193-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-9"><a href="model-inferencing.html#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb193-10"><a href="model-inferencing.html#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The prediction or response obtained from the SageMaker endpoint.</span></span>
<span id="cb193-11"><a href="model-inferencing.html#cb193-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-12"><a href="model-inferencing.html#cb193-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Example:</span></span>
<span id="cb193-13"><a href="model-inferencing.html#cb193-13" aria-hidden="true" tabindex="-1"></a><span class="co">        # Query a SageMaker endpoint with JSON data</span></span>
<span id="cb193-14"><a href="model-inferencing.html#cb193-14" aria-hidden="true" tabindex="-1"></a><span class="co">        endpoint_name = &quot;my-endpoint&quot;</span></span>
<span id="cb193-15"><a href="model-inferencing.html#cb193-15" aria-hidden="true" tabindex="-1"></a><span class="co">        input_data = &#39;{&quot;feature1&quot;: 0.5, &quot;feature2&quot;: 1.2}&#39;</span></span>
<span id="cb193-16"><a href="model-inferencing.html#cb193-16" aria-hidden="true" tabindex="-1"></a><span class="co">        prediction = query_endpoint(endpoint_name, input_data)</span></span>
<span id="cb193-17"><a href="model-inferencing.html#cb193-17" aria-hidden="true" tabindex="-1"></a><span class="co">        print(f&quot;Endpoint prediction: {prediction}&quot;)</span></span>
<span id="cb193-18"><a href="model-inferencing.html#cb193-18" aria-hidden="true" tabindex="-1"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb193-19"><a href="model-inferencing.html#cb193-19" aria-hidden="true" tabindex="-1"></a>    AWS_REGION <span class="op">=</span> os.getenv(<span class="st">&quot;AWS_REGION&quot;</span>)</span>
<span id="cb193-20"><a href="model-inferencing.html#cb193-20" aria-hidden="true" tabindex="-1"></a>    client <span class="op">=</span> boto3.session.Session().client(<span class="st">&quot;sagemaker-runtime&quot;</span>, AWS_REGION)</span>
<span id="cb193-21"><a href="model-inferencing.html#cb193-21" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.invoke_endpoint(</span>
<span id="cb193-22"><a href="model-inferencing.html#cb193-22" aria-hidden="true" tabindex="-1"></a>        EndpointName<span class="op">=</span>app_name,</span>
<span id="cb193-23"><a href="model-inferencing.html#cb193-23" aria-hidden="true" tabindex="-1"></a>        Body<span class="op">=</span>data,</span>
<span id="cb193-24"><a href="model-inferencing.html#cb193-24" aria-hidden="true" tabindex="-1"></a>        ContentType<span class="op">=</span><span class="st">&quot;application/json&quot;</span>,</span>
<span id="cb193-25"><a href="model-inferencing.html#cb193-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb193-26"><a href="model-inferencing.html#cb193-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-27"><a href="model-inferencing.html#cb193-27" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> response[<span class="st">&quot;Body&quot;</span>].read().decode(<span class="st">&quot;ascii&quot;</span>)</span>
<span id="cb193-28"><a href="model-inferencing.html#cb193-28" aria-hidden="true" tabindex="-1"></a>    prediction <span class="op">=</span> json.loads(prediction)</span>
<span id="cb193-29"><a href="model-inferencing.html#cb193-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> prediction</span></code></pre></div>

</div>
</div>
</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="pipeline-workflow-steps.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glossary.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": true,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/seblum/kubernetes-training/edit/master/09.4-Deployment-Usage_Model-Inferencing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
